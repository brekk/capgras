import type { Either } from "Either"
import type { Error } from "IO"

import type { MadJson, MadPackage } from "@/Parse"

import { Left, Right, mapLeft } from "Either"
import File from "File"
import IO from "IO"
import { parse } from "Json/Parse"
import Process from "Process"
import Wish from "Wish"

import { madJson, unpack } from "@/Parse"



// read a madlib.json file like:
/*
{
  "name": "MadDoc",
  "version": "0.0.7",
  "madlibVersion": "0.23.14",
  "main": "src/Main.mad",
  "dependencies": [
    {
      "minVersion": "2.0.2",
      "url": "https://github.com/madlib-lang/madmarkdown-renderer/archive/refs/tags/v2.0.2.zip",
      "description": "MadMarkdownRenderer"
    },
    {
      "minVersion": "7.0.2",
      "url": "https://github.com/madlib-lang/madui/archive/refs/tags/v7.0.2.zip",
      "description": "MadUI"
    }
  ]
}
*/
// walk the dependencies and for each, determine if there's a need to replace

readMadlibJson :: String -> Wish Error MadPackage
export readMadlibJson = (source) => pipe(
  File.read,
  map(
    pipe(
      parse(madJson),
      unpack,
    ),
  ),
)(source)
